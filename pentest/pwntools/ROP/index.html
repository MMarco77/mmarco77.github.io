<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ROP</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../../index.html">knowledge-based </a></li><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Knowledges</li><li class="chapter-item "><a href="../../../tools/index.html"><strong aria-hidden="true">1.</strong> Tools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/android/index.html"><strong aria-hidden="true">1.1.</strong> Android</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/android/adb/index.html"><strong aria-hidden="true">1.1.1.</strong> ADB</a></li><li class="chapter-item "><a href="../../../tools/android/apktool/index.html"><strong aria-hidden="true">1.1.2.</strong> APKTool</a></li><li class="chapter-item "><a href="../../../tools/android/dex2jar/index.html"><strong aria-hidden="true">1.1.3.</strong> Dex2Jar</a></li><li class="chapter-item "><a href="../../../tools/android/devtools_flutter/index.html"><strong aria-hidden="true">1.1.4.</strong> DevTools Flutter</a></li><li class="chapter-item "><a href="../../../tools/android/emulator/index.html"><strong aria-hidden="true">1.1.5.</strong> emulator</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/android/emulator/AVDManager/index.html"><strong aria-hidden="true">1.1.5.1.</strong> AVDManager</a></li></ol></li><li class="chapter-item "><a href="../../../tools/android/Drozer/index.html"><strong aria-hidden="true">1.1.6.</strong> Drozer</a></li><li class="chapter-item "><a href="../../../tools/android/frida/index.html"><strong aria-hidden="true">1.1.7.</strong> Frida</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/android/frida/setup/index.html"><strong aria-hidden="true">1.1.7.1.</strong> Setup</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/android/frida/setup/NotRooted/index.html"><strong aria-hidden="true">1.1.7.1.1.</strong> Setup on not rooted device(s)</a></li><li class="chapter-item "><a href="../../../tools/android/frida/setup/emulator/index.html"><strong aria-hidden="true">1.1.7.1.2.</strong> Setup on emulator</a></li><li class="chapter-item "><a href="../../../tools/android/frida/setup/AndroidDocker/index.html"><strong aria-hidden="true">1.1.7.1.3.</strong> Setup in Android docker</a></li></ol></li><li class="chapter-item "><a href="../../../tools/android/frida/snippets/index.html"><strong aria-hidden="true">1.1.7.2.</strong> Snippets</a></li><li class="chapter-item "><a href="../../../tools/android/frida/tutorials/index.html"><strong aria-hidden="true">1.1.7.3.</strong> Tutorials</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/android/frida/tutorials/hacktricks/index.html"><strong aria-hidden="true">1.1.7.3.1.</strong> hacktricks</a></li><li class="chapter-item "><a href="../../../tools/android/frida/tutorials/owasp/index.html"><strong aria-hidden="true">1.1.7.3.2.</strong> Owasp</a></li><li class="chapter-item "><a href="../../../tools/android/frida/tutorials/BeetleBug/index.html"><strong aria-hidden="true">1.1.7.3.3.</strong> BeetleBug</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../tools/android/r2frida/index.html"><strong aria-hidden="true">1.1.8.</strong> R2Frida</a></li><li class="chapter-item "><a href="../../../tools/android/Gnirehtet/index.html"><strong aria-hidden="true">1.1.9.</strong> Gnirehtet</a></li></ol></li><li class="chapter-item "><a href="../../../tools/docker/index.html"><strong aria-hidden="true">1.2.</strong> Docker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/docker/dockerfile/index.html"><strong aria-hidden="true">1.2.1.</strong> Dockerfile</a></li></ol></li><li class="chapter-item "><a href="../../../tools/git/index.html"><strong aria-hidden="true">1.3.</strong> Git</a></li><li class="chapter-item "><a href="../../../tools/graphviz/index.html"><strong aria-hidden="true">1.4.</strong> GraphViz</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/graphviz/examples/index.html"><strong aria-hidden="true">1.4.1.</strong> Examples</a></li></ol></li><li class="chapter-item "><a href="../../../tools/linux/index.html"><strong aria-hidden="true">1.5.</strong> linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../tools/linux/bash/index.html"><strong aria-hidden="true">1.5.1.</strong> bash</a></li><li class="chapter-item "><a href="../../../tools/linux/zsh/index.html"><strong aria-hidden="true">1.5.2.</strong> zsh</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../forensics/index.html"><strong aria-hidden="true">2.</strong> Forensics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../forensics/volatility3/index.html"><strong aria-hidden="true">2.1.</strong> volatility3</a></li><li class="chapter-item "><a href="../../../forensics/glogg/index.html"><strong aria-hidden="true">2.2.</strong> glogg</a></li><li class="chapter-item "><a href="../../../forensics/sleuthkit/index.html"><strong aria-hidden="true">2.3.</strong> sleuthkit</a></li></ol></li><li class="chapter-item "><a href="../../../technics/index.html"><strong aria-hidden="true">3.</strong> Technics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../technics/natural-referencing/index.html"><strong aria-hidden="true">3.1.</strong> Natural Referencing</a></li><li class="chapter-item "><a href="../../../technics/web-scrapping/index.html"><strong aria-hidden="true">3.2.</strong> Web Scrapping</a></li><li class="chapter-item "><a href="../../../technics/wireshark/index.html"><strong aria-hidden="true">3.3.</strong> Wireshark</a></li><li class="chapter-item "><a href="../../../technics/nmap/index.html"><strong aria-hidden="true">3.4.</strong> nmap</a></li></ol></li><li class="chapter-item "><a href="../../../OSINT/index.html"><strong aria-hidden="true">4.</strong> OSINT</a></li><li class="chapter-item expanded "><a href="../../../pentest/index.html"><strong aria-hidden="true">5.</strong> Pentest</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/BinaryExploitation/index.html"><strong aria-hidden="true">5.1.</strong> BinaryExploitation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/BinaryExploitation/Linux/index.html"><strong aria-hidden="true">5.1.1.</strong> Linux</a></li></ol></li><li class="chapter-item "><a href="../../../pentest/useful-commands/index.html"><strong aria-hidden="true">5.2.</strong> Useful Commands</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/useful-commands/ssh/index.html"><strong aria-hidden="true">5.2.1.</strong> ssh</a></li></ol></li><li class="chapter-item "><a href="../../../pentest/Metasploit/index.html"><strong aria-hidden="true">5.3.</strong> Netasploit</a></li><li class="chapter-item "><a href="../../../pentest/PwdCracking/index.html"><strong aria-hidden="true">5.4.</strong> PwdCracking</a></li><li class="chapter-item "><a href="../../../pentest/gdb/index.html"><strong aria-hidden="true">5.5.</strong> GDB</a></li><li class="chapter-item "><a href="../../../pentest/BurpSuite/index.html"><strong aria-hidden="true">5.6.</strong> Burp Suite</a></li><li class="chapter-item expanded "><a href="../../../pentest/pwntools/index.html"><strong aria-hidden="true">5.7.</strong> pwntools</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/pwntools/cheat_sheet/index.html"><strong aria-hidden="true">5.7.1.</strong> Cheat Sheet</a></li><li class="chapter-item "><a href="../../../pentest/pwntools/assembly/index.html"><strong aria-hidden="true">5.7.2.</strong> Assembly</a></li><li class="chapter-item expanded "><a href="../../../pentest/pwntools/ROP/index.html" class="active"><strong aria-hidden="true">5.7.3.</strong> ROP</a></li><li class="chapter-item "><a href="../../../pentest/pwntools/debugging/index.html"><strong aria-hidden="true">5.7.4.</strong> Pwntools Debugging</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/pwntools/debugging/scripts/index.html"><strong aria-hidden="true">5.7.4.1.</strong> Useful scripts</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/pwntools/debugging/scripts/interactive_debugging/index.html"><strong aria-hidden="true">5.7.4.1.1.</strong> Interactive debugging</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><a href="../../../pentest/Mobile/index.html"><strong aria-hidden="true">5.8.</strong> Mobile</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/index.html"><strong aria-hidden="true">5.8.1.</strong> red_fox_sec_training</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/web_view/index.html"><strong aria-hidden="true">5.8.1.1.</strong> Exploiting Android WebView Vulnerabilities</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/broad_cast_receivers/index.html"><strong aria-hidden="true">5.8.1.2.</strong> Exploiting Broadcast Receivers</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/content_providers/index.html"><strong aria-hidden="true">5.8.1.3.</strong> Exploiting Content Providers</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/drozer/index.html"><strong aria-hidden="true">5.8.1.4.</strong> Android Pentesting with Drozer</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/tapjacking/index.html"><strong aria-hidden="true">5.8.1.5.</strong> Android Tapjacking Vulnerability</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/crypto/index.html"><strong aria-hidden="true">5.8.1.6.</strong> Broken Cryptography in Android Applications</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/pentest_method/index.html"><strong aria-hidden="true">5.8.1.7.</strong> Android Pentesting Methodology (Pt. 1)</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/pentest_method/index.html"><strong aria-hidden="true">5.8.1.8.</strong> Android Pentesting Methodology (Pt. 2)</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/pentest_method/index.html"><strong aria-hidden="true">5.8.1.9.</strong> Android Pentesting Methodology (Pt. 3)</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/frida/index.html"><strong aria-hidden="true">5.8.1.10.</strong> Android Root Detection Bypass Using Frida</a></li><li class="chapter-item "><a href="../../../pentest/Mobile/red_fox_sec_training/frida_ssl_pinning/index.html"><strong aria-hidden="true">5.8.1.11.</strong> SSL Pinning Bypass For Android Using Frida</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../pentest/lab_kali_docker/index.html"><strong aria-hidden="true">5.9.</strong> Lab. Kali Docker</a></li><li class="chapter-item "><a href="../../../pentest/Wireshark/index.html"><strong aria-hidden="true">5.10.</strong> Wireshark</a></li><li class="chapter-item "><a href="../../../pentest/python_venv/index.html"><strong aria-hidden="true">5.11.</strong> python_venv</a></li></ol></li><li class="chapter-item "><a href="../../../dev/index.html"><strong aria-hidden="true">6.</strong> dev</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/python/index.html"><strong aria-hidden="true">6.1.</strong> Python</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/python/snippets/index.html"><strong aria-hidden="true">6.1.1.</strong> snippets</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/python/snippets/FullClickSnippet/index.html"><strong aria-hidden="true">6.1.1.1.</strong> Full Click Snippets</a></li><li class="chapter-item "><a href="../../../dev/python/snippets/GetPostRequest/index.html"><strong aria-hidden="true">6.1.1.2.</strong> Get/Post Request</a></li><li class="chapter-item "><a href="../../../dev/python/snippets/MovieToken/index.html"><strong aria-hidden="true">6.1.1.3.</strong> MovieToken</a></li><li class="chapter-item "><a href="../../../dev/python/snippets/TcpChallenges/index.html"><strong aria-hidden="true">6.1.1.4.</strong> TCP Challenges</a></li><li class="chapter-item "><a href="../../../dev/python/snippets/FlaskGunicorn/index.html"><strong aria-hidden="true">6.1.1.5.</strong> Flask / Gunicorn</a></li><li class="chapter-item "><a href="../../../dev/python/snippets/ServerChallenge_pwntool/index.html"><strong aria-hidden="true">6.1.1.6.</strong> Server Chall. with Pwntool</a></li><li class="chapter-item "><a href="../../../dev/python/snippets/SolveEquation/index.html"><strong aria-hidden="true">6.1.1.7.</strong> Solve Equation</a></li></ol></li></ol></li><li class="chapter-item "><a href="../../../dev/rust/index.html"><strong aria-hidden="true">6.2.</strong> Rust</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/rust/snippets/index.html"><strong aria-hidden="true">6.2.1.</strong> snippets</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/rust/snippets/error/index.html"><strong aria-hidden="true">6.2.1.1.</strong> Error handling</a></li></ol></li><li class="chapter-item "><a href="../../../dev/rust/optimization/index.html"><strong aria-hidden="true">6.2.2.</strong> Optimization</a></li></ol></li><li class="chapter-item "><a href="../../../dev/Android/index.html"><strong aria-hidden="true">6.3.</strong> Android</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/Android/MinimalProject/index.html"><strong aria-hidden="true">6.3.1.</strong> Minimal Project</a></li></ol></li><li class="chapter-item "><a href="../../../dev/IA/index.html"><strong aria-hidden="true">6.4.</strong> IA</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../dev/IA/Ollama_vsCode/index.html"><strong aria-hidden="true">6.4.1.</strong> Ollama_vscode</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h1>
<ul>
<li><a href="#background">Background</a></li>
<li><a href="#loading-an-elf">Loading an ELF</a>
<ul>
<li><a href="#fixing-addresses">Fixing Addresses</a></li>
</ul>
</li>
<li><a href="#inspecting-gadgets">Inspecting Gadgets</a></li>
<li><a href="#viewing-all-gadgets">Viewing All Gadgets</a>
<ul>
<li><a href="#really-viewing-all-gadgets">Really viewing <em>ALL</em> Gadgets</a></li>
</ul>
</li>
<li><a href="#adding-raw-data">Adding Raw Data</a></li>
<li><a href="#dumping-rop-stacks">Dumping ROP stacks</a></li>
<li><a href="#extracting-raw-bytes">Extracting Raw Bytes</a></li>
<li><a href="#calling-functions-manually">Calling Functions Magically</a>
<ul>
<li><a href="#calling-functions-by-name">Calling Functions by Name</a></li>
</ul>
</li>
<li><a href="#multiple-elfs">Multiple ELFs</a></li>
<li><a href="#getting-a-shell">Getting a shell</a></li>
</ul>
<h1 id="background"><a class="header" href="#background">Background</a></h1>
<p>Return-oriented programming (ROP) is a technique for bypassing NX (no-execute, also known as Data Execution Prevention (DEP)).</p>
<p>Pwntools has several features that make ROP exploitation simpler, but only works on i386 and amd64 architectures.</p>
<h1 id="loading-an-elf"><a class="header" href="#loading-an-elf">Loading an ELF</a></h1>
<p>To create a <code>ROP</code> object, just pass it an <code>ELF</code> file.</p>
<pre><code class="language-py">elf = ELF('/bin/sh')
rop = ROP(elf)
</code></pre>
<p>This will automatically load the binary, and extract most simple gadgets from it.  For example, if you want to load the <code>rbx</code> register:</p>
<pre><code>rop.rbx
# Gadget(0x5fd5, ['pop rbx', 'ret'], ['rbx'], 0x8)
</code></pre>
<h2 id="fixing-addresses"><a class="header" href="#fixing-addresses">Fixing Addresses</a></h2>
<p>Here we can see the address of the gadget, the contents of its disassembly, what register it loads, and by how much the stack is adjusted when the gadget is executed.</p>
<p>Since in our example, <code>/bin/sh</code> is position-independent (i.e. uses ASLR), we can adjust the load address on the ELF object first.</p>
<pre><code>elf.address = 0xff000000
rop = ROP(elf)
rop.rbx
# Gadget(0xff005fd5, ['pop rbx', 'ret'], ['rbx'], 0x8)
</code></pre>
<h1 id="inspecting-gadgets"><a class="header" href="#inspecting-gadgets">Inspecting Gadgets</a></h1>
<p>You can ask the ROP object how to load any register you want, through magic accessors.  We used <code>rbx</code> above, but we can also look for other registers.</p>
<pre><code>rop.rbx
# Gadget(0xff005fd5, ['pop rbx', 'ret'], ['rbx'], 0x8)
</code></pre>
<p>If the register cannot be loaded, the return value is <code>None</code>.  In our example, there are no <code>pop rcx; ret</code> gadgets for example.</p>
<pre><code>rop.rcx
# None
</code></pre>
<h2 id="viewing-all-gadgets"><a class="header" href="#viewing-all-gadgets">Viewing All Gadgets</a></h2>
<p>Pwntools intentionally excludes most non-trivial gadgets, but you can see a list of what it has loaded by looking at the <code>ROP.gadgets</code> property, which maps the address of  a gadget to the gadget itself.</p>
<pre><code>rop.gadgets
# {4278225723: Gadget(0xff008b3b, ['add esp, 0x10', 'pop rbx', 'pop rbp', 'pop r12', 'ret'], ['rbx', 'rbp', 'r12'], 0x20),
#  4278278088: Gadget(0xff0157c8, ['add esp, 0x130', 'pop rbp', 'ret'], ['rbp'], 0x138),
#  4278284789: Gadget(0xff0171f5, ['add esp, 0x138', 'pop rbx', 'pop rbp', 'ret'], ['rbx', 'rbp'], 0x144),
#  4278272966: Gadget(0xff0143c6, ['add esp, 0x18', 'ret'], [], 0x1c),
#  4278239612: Gadget(0xff00c17c, ['add esp, 0x20', 'pop rbx', 'pop rbp', 'pop r12', 'ret'], ['rbx', 'rbp', 'r12'], 0x30),
#  4278259611: Gadget(0xff010f9b, ['add esp, 0x28', 'pop rbp', 'pop r12', 'ret'], ['rbp', 'r12'], 0x34),
# ...
#  4278216828: Gadget(0xff00687c, ['pop rsp', 'pop r13', 'ret'], ['rsp', 'r13'], 0xc),
#  4278214225: Gadget(0xff005e51, ['pop rsp', 'ret'], ['rsp'], 0x8),
#  4278210586: Gadget(0xff00501a, ['ret'], [], 0x4)}
</code></pre>
<h2 id="really-viewing-all-gadgets"><a class="header" href="#really-viewing-all-gadgets">Really Viewing <em>ALL</em> Gadgets</a></h2>
<p>Pwntools ROP filters out non-trivial gadgets, so if it doesn't have something you want, we recommend using ROPGadget to inspect the binary.</p>
<h1 id="adding-raw-data"><a class="header" href="#adding-raw-data">Adding Raw Data</a></h1>
<p>In order to add raw data to the ROP stack, simply call <code>ROP.raw()</code>.</p>
<pre><code class="language-py">rop.raw(0xdeadbeef)
rop.raw(0xcafebabe)
rop.raw('asdf')
</code></pre>
<h1 id="dumping-rop-stacks"><a class="header" href="#dumping-rop-stacks">Dumping ROP stacks</a></h1>
<p>Now that we have some gadgets, let's look at what's on the ROP stack:</p>
<pre><code class="language-py">print(rop.dump())
# 0x0000:       0xdeadbeef
# 0x0004:       0xcafebabe
# 0x0008:          b'asdf' 'asdf'
</code></pre>
<h1 id="extracting-the-raw-bytes"><a class="header" href="#extracting-the-raw-bytes">Extracting the Raw Bytes</a></h1>
<p>Now that we have a ROP stack, we want the raw bytes out of it.  Use the <code>bytes()</code> method  to do this.</p>
<pre><code class="language-py">print(hexdump(bytes(rop)))
# 00000000  ef be ad de  be ba fe ca  61 73 64 66               │····│····│asdf│
# 0000000c
</code></pre>
<h1 id="calling-functions-magically"><a class="header" href="#calling-functions-magically">Calling Functions Magically</a></h1>
<p>The real power of Pwntools' ROP tooling is the ability to invoke arbitrary functions, either via magic accessors or via the <code>ROP.call()</code> routine.</p>
<pre><code>elf = ELF('/bin/sh')
rop = ROP(elf)
rop.call(0xdeadbeef, [0, 1])
print(rop.dump())
# 0x0000:       0xdeadbeef 0xdeadbeef(0, 1, 2, 3)
# 0x0004:          b'baaa' &lt;return address&gt;
# 0x0008:              0x0 arg0
# 0x000c:              0x1 arg1
</code></pre>
<p>Notice here that it's using a 32-bit ABI, which is not correct.  We can also do ROP against 64-bit binaries, but we need to set <code>context.arch</code> accordingly.  We can use <code>context.binary</code> to do this automagically.</p>
<pre><code>context.binary = elf = ELF('/bin/sh')
rop = ROP(elf)
rop.call(0xdeadbeef, [0, 1])
print(rop.dump())
# 0x0000:           0x61aa pop rdi; ret
# 0x0008:              0x0 [arg0] rdi = 0
# 0x0010:           0x5f73 pop rsi; ret
# 0x0018:              0x1 [arg1] rsi = 1
# 0x0020:       0xdeadbeef
</code></pre>
<h1 id="calling-functions-by-name"><a class="header" href="#calling-functions-by-name">Calling Functions by Name</a></h1>
<p>If your library has a function you want to call in its GOT/PLT, or there are symbols for the binary, you can invoke function names directly.</p>
<pre><code>context.binary = elf = ELF('/bin/sh')
rop = ROP(elf)
rop.execve(0xdeadbeef)
print(rop.dump())
# 0x0000:           0x61aa pop rdi; ret
# 0x0008:       0xdeadbeef [arg0] rdi = 3735928559
# 0x0010:           0x5824 execve
</code></pre>
<h1 id="multiple-elfs"><a class="header" href="#multiple-elfs">Multiple ELFs</a></h1>
<p>Generally, more than one ELF is available in the address space of your process at a time.  Let's look at an example that uses <code>/bin/sh</code> as well as its <code>libc</code>.  Originally, we looked at <code>rop.rcx</code> and it was <code>None</code>, since there is no <code>pop rcx; ret</code> gadget in bash.  However, now we have all of the gadgets from <code>libc</code> available as well.</p>
<pre><code class="language-py">context.binary = elf = ELF('/bin/sh')
libc = elf.libc

elf.address = 0xAA000000
libc.address = 0xBB000000

rop.rax
# Gadget(0xaa00eb87, ['pop rax', 'ret'], ['rax'], 0x10)
rop.rbx
# Gadget(0xaa005fd5, ['pop rbx', 'ret'], ['rbx'], 0x10)
rop.rcx
# Gadget(0xbb09f822, ['pop rcx', 'ret'], ['rcx'], 0x10)
rop.rdx
# Gadget(0xbb117960, ['pop rdx', 'add rsp, 0x38', 'ret'], ['rdx'], 0x48)
</code></pre>
<p>Notice how the <code>rax</code> and <code>rbx</code> gadgets are in the main binary (0xAA...) while the second two are in libc (0xBB...).</p>
<p>Now let's do a more complex call!</p>
<pre><code class="language-py">rop.memcpy(0xaaaaaaaa, 0xbbbbbbbb, 0xcccccccc)
print(rop.dump())
# 0x0000:       0xbb11c1e1 pop rdx; pop r12; ret
# 0x0008:       0xcccccccc [arg2] rdx = 3435973836
# 0x0010:      b'eaaafaaa' &lt;pad r12&gt;
# 0x0018:       0xaa0061aa pop rdi; ret
# 0x0020:       0xaaaaaaaa [arg0] rdi = 2863311530
# 0x0028:       0xaa005f73 pop rsi; ret
# 0x0030:       0xbbbbbbbb [arg1] rsi = 3149642683
# 0x0038:       0xaa0058a4 memcpy
</code></pre>
<p>Note that Pwntools was able to use the <code>pop rdx; pop r12; ret</code> gadget, and account for the extra value needed on the stack.   Also note that the symbolic value of each item is listen  in <code>rop.dump()</code>.  For  example, it shows that we are settings rdx=3435973836.</p>
<h1 id="getting-a-shell"><a class="header" href="#getting-a-shell">Getting a shell</a></h1>
<p>Sometimes, getting a shell can be pretty easy!  Let's call <code>execve</code> directly, and find an instance of <code>&quot;/bin/sh\x00&quot;</code> to pass as the first argument from somewhere within memory.</p>
<pre><code class="language-py">context.binary = elf = ELF('/bin/sh')
libc = elf.libc

elf.address = 0xAA000000
libc.address = 0xBB000000

rop = ROP([elf, libc])

binsh = next(libc.search(b&quot;/bin/sh\x00&quot;))
rop.execve(binsh, 0, 0)
</code></pre>
<p>Show our ROP stack</p>
<pre><code class="language-py">print(rop.dump())
# 0x0000:       0xbb11c1e1 pop rdx; pop r12; ret
# 0x0008:              0x0 [arg2] rdx = 0
# 0x0010:      b'eaaafaaa' &lt;pad r12&gt;
# 0x0018:       0xaa0061aa pop rdi; ret
# 0x0020:       0xbb1b75aa [arg0] rdi = 3139138986
# 0x0028:       0xaa005f73 pop rsi; ret
# 0x0030:              0x0 [arg1] rsi = 0
# 0x0038:       0xaa005824 execve
</code></pre>
<p>Extract the raw bytes for the ROP</p>
<pre><code class="language-py">print(hexdump(bytes(rop)))
# 00000000  e1 c1 11 bb  00 00 00 00  00 00 00 00  00 00 00 00  │····│····│····│····│
# 00000010  65 61 61 61  66 61 61 61  aa 61 00 aa  00 00 00 00  │eaaa│faaa│·a··│····│
# 00000020  aa 75 1b bb  00 00 00 00  73 5f 00 aa  00 00 00 00  │·u··│····│s_··│····│
# 00000030  00 00 00 00  00 00 00 00  24 58 00 aa  00 00 00 00  │····│····│$X··│····│
# 00000040
</code></pre>
<h2 id="rop-chain"><a class="header" href="#rop-chain">ROP chain</a></h2>
<p><code>rop.chain</code> command generate a chain that use gadgets available into the ELF binary.</p>
<p>Example:</p>
<p>[Shell python]</p>
<pre><code class="language-shell">&gt;&gt;&gt; elf = ELF('./jean_pile')

&gt;&gt;&gt; rop = ROP(elf)

&gt;&gt;&gt; rop.gadgets
{4195907: Gadget(0x400643, ['add esp, 8', 'ret'], [], 0x10),
 4195906: Gadget(0x400642, ['add rsp, 8', 'ret'], [], 0x10),
 4197002: Gadget(0x400a8a, ['leave', 'ret'], ['rbp', 'rsp'], 0x2540be407),
 4197244: Gadget(0x400b7c, ['pop r12', 'pop r13', 'pop r14', 'pop r15', 'ret'], ['r12', 'r13', 'r14', 'r15'], 0x28),
 4197246: Gadget(0x400b7e, ['pop r13', 'pop r14', 'pop r15', 'ret'], ['r13', 'r14', 'r15'], 0x20),
 4197248: Gadget(0x400b80, ['pop r14', 'pop r15', 'ret'], ['r14', 'r15'], 0x18),
 4197250: Gadget(0x400b82, ['pop r15', 'ret'], ['r15'], 0x10),
 4197243: Gadget(0x400b7b, ['pop rbp', 'pop r12', 'pop r13', 'pop r14', 'pop r15', 'ret'], ['rbp', 'r12', 'r13', 'r14', 'r15'], 0x30),
 4197247: Gadget(0x400b7f, ['pop rbp', 'pop r14', 'pop r15', 'ret'], ['rbp', 'r14', 'r15'], 0x20),
 4196168: Gadget(0x400748, ['pop rbp', 'ret'], ['rbp'], 0x10),
 4197251: Gadget(0x400b83, ['pop rdi', 'ret'], ['rdi'], 0x10),
 4197249: Gadget(0x400b81, ['pop rsi', 'pop r15', 'ret'], ['rsi', 'r15'], 0x18),
 4197245: Gadget(0x400b7d, ['pop rsp', 'pop r13', 'pop r14', 'pop r15', 'ret'], ['rsp', 'r13', 'r14', 'r15'], 0x28),
 4195910: Gadget(0x400646, ['ret'], [], 0x8)}

 &gt;&gt;&gt; rop.puts(elf.got['puts'])

&gt;&gt;&gt; hex(elf.got['puts'])
'0x602018'

&gt;&gt;&gt; print(hexdump(bytes(rop)))
00000000  83 0b 40 00  00 00 00 00  18 20 60 00  00 00 00 00  │··@·│····│· `·│····│
00000010  60 06 40 00  00 00 00 00                            │`·@·│····│
00000018

&gt;&gt;&gt; print(rop.dump())
0x0000:         0x400b83 pop rdi; ret
0x0008:         0x602018 [arg0] rdi = got.puts
0x0010:         0x400660 puts

&gt;&gt;&gt; rop.chain()
b'\x83\x0b@\x00\x00\x00\x00\x00\x18 `\x00\x00\x00\x00\x00`\x06@\x00\x00\x00\x00\x00'

&gt;&gt;&gt; ','.join([hex(i) for i in rop.chain()])
'0x83,0xb,0x40,0x0, 0x0,0x0,0x0,0x0, 0x18,0x20,0x60,0x0, 0x0,0x0,0x0,0x0, 0x60,0x6,0x40,0x0 ,0x0,0x0,0x0,0x0'
# 64bits little endian
# 0x00000000 0x00400b83
# 0x00000000 0x00602018
# 0x00000000 0x00400660
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../pentest/pwntools/assembly/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../../pentest/pwntools/debugging/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../pentest/pwntools/assembly/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../../pentest/pwntools/debugging/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../../mermaid.min.js"></script>
        <script type="text/javascript" src="../../../mermaid-init.js"></script>
    </body>
</html>
